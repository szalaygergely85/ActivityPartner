<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" class="dark" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Delete Account - Vivento</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&amp;display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#0d7ff2",
                        "danger": "#ef4444",
                        "background-light": "#f5f7f8",
                        "background-dark": "#0a0f14",
                        "card-dark": "#161e27",
                    },
                    fontFamily: {
                        "display": ["Plus Jakarta Sans", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.5rem",
                        "lg": "1rem",
                        "xl": "1.5rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
    <style>
        body {
            min-height: max(884px, 100dvh);
        }
    </style>
</head>
<body class="bg-background-dark font-display text-white min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-lg bg-card-dark border border-gray-800 rounded-3xl overflow-hidden shadow-2xl">
        <div class="flex items-center justify-between p-6 pb-2">
            <a href="/" class="text-gray-400 hover:text-white transition-colors">
                <span class="material-symbols-outlined">arrow_back</span>
            </a>
            <h2 class="text-sm font-semibold text-gray-400 uppercase tracking-widest">Privacy Settings</h2>
            <div class="w-6"></div>
        </div>

        <div class="p-6 pt-4 text-center">
            <div class="mb-4 inline-flex h-16 w-16 items-center justify-center rounded-full bg-primary/10 text-primary">
                <span class="material-symbols-outlined text-4xl">explore</span>
            </div>
            <h1 class="text-2xl font-extrabold text-white mb-2">Vivento</h1>
            <p class="text-gray-400 text-sm mb-6">Account Deletion Request</p>

            <!-- Success Message -->
            <div id="success-message" class="hidden bg-green-500/10 border border-green-500/30 rounded-2xl p-5 mb-6 text-left">
                <div class="flex items-start gap-3">
                    <span class="material-symbols-outlined text-green-500 text-xl shrink-0">check_circle</span>
                    <div>
                        <h3 class="text-green-500 font-bold mb-1">Request Submitted</h3>
                        <p class="text-sm text-gray-300">Your account deletion request has been received. You will receive an email confirmation shortly. Your account and all associated data will be permanently deleted within 30 days.</p>
                    </div>
                </div>
            </div>

            <!-- Main Content (hidden after submission) -->
            <div id="main-content">
                <div class="mb-6 inline-flex h-20 w-20 items-center justify-center rounded-full bg-danger/10 text-danger ring-8 ring-danger/5">
                    <span class="material-symbols-outlined text-5xl font-bold">warning</span>
                </div>

                <h2 class="text-xl font-bold text-white mb-2">Request Account Deletion</h2>
                <p class="text-gray-400 text-sm leading-relaxed mb-6">
                    To delete your Vivento account and all associated data, please follow the steps below. This action is irreversible.
                </p>

                <!-- Steps to Delete -->
                <div class="bg-black/20 rounded-2xl p-5 mb-6 text-left border border-white/5">
                    <h3 class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-4">How to Delete Your Account:</h3>
                    <ol class="space-y-3">
                        <li class="flex items-start gap-3">
                            <span class="flex h-6 w-6 shrink-0 items-center justify-center rounded-full bg-primary/20 text-primary text-xs font-bold">1</span>
                            <span class="text-sm text-gray-300">Enter your registered email address below</span>
                        </li>
                        <li class="flex items-start gap-3">
                            <span class="flex h-6 w-6 shrink-0 items-center justify-center rounded-full bg-primary/20 text-primary text-xs font-bold">2</span>
                            <span class="text-sm text-gray-300">Confirm that you understand this action is permanent</span>
                        </li>
                        <li class="flex items-start gap-3">
                            <span class="flex h-6 w-6 shrink-0 items-center justify-center rounded-full bg-primary/20 text-primary text-xs font-bold">3</span>
                            <span class="text-sm text-gray-300">Submit your request - we'll process it within 30 days</span>
                        </li>
                    </ol>
                </div>

                <!-- What Will Be Deleted -->
                <div class="bg-black/20 rounded-2xl p-5 mb-6 text-left border border-white/5">
                    <h3 class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-4">Data That Will Be Permanently Deleted:</h3>
                    <ul class="space-y-3">
                        <li class="flex items-start gap-3">
                            <span class="material-symbols-outlined text-danger text-lg shrink-0">close</span>
                            <span class="text-sm text-gray-300">Profile information (name, email, bio, profile photos)</span>
                        </li>
                        <li class="flex items-start gap-3">
                            <span class="material-symbols-outlined text-danger text-lg shrink-0">close</span>
                            <span class="text-sm text-gray-300">All activities you created and your participation history</span>
                        </li>
                        <li class="flex items-start gap-3">
                            <span class="material-symbols-outlined text-danger text-lg shrink-0">close</span>
                            <span class="text-sm text-gray-300">Messages, comments, and reviews</span>
                        </li>
                        <li class="flex items-start gap-3">
                            <span class="material-symbols-outlined text-danger text-lg shrink-0">close</span>
                            <span class="text-sm text-gray-300">Location data and preferences</span>
                        </li>
                        <li class="flex items-start gap-3">
                            <span class="material-symbols-outlined text-danger text-lg shrink-0">close</span>
                            <span class="text-sm text-gray-300">Push notification tokens and settings</span>
                        </li>
                    </ul>
                </div>

                <!-- Data Retention Notice -->
                <div class="bg-blue-500/10 border border-blue-500/20 rounded-2xl p-5 mb-6 text-left">
                    <div class="flex items-start gap-3">
                        <span class="material-symbols-outlined text-blue-400 text-lg shrink-0">info</span>
                        <div>
                            <h3 class="text-xs font-bold text-blue-400 uppercase tracking-wider mb-2">Data Retention Notice</h3>
                            <p class="text-sm text-gray-300">Your data will be permanently deleted within 30 days of your request. During this period, you can contact us to cancel the deletion. After 30 days, no data can be recovered. Anonymized aggregate data (not personally identifiable) may be retained for analytics purposes.</p>
                        </div>
                    </div>
                </div>

                <!-- Deletion Form -->
                <form id="delete-form" class="space-y-6 text-left">
                    <div class="space-y-3">
                        <label class="text-xs font-bold text-gray-500 uppercase tracking-wider" for="email">
                            Your Registered Email Address
                        </label>
                        <input
                            class="w-full bg-background-dark border border-gray-700 rounded-xl h-14 px-4 text-white focus:border-danger focus:ring-danger placeholder:text-gray-600"
                            id="email"
                            name="email"
                            type="email"
                            placeholder="Enter your email address"
                            required
                        />
                    </div>

                    <label class="flex items-start gap-3 cursor-pointer group">
                        <div class="pt-0.5">
                            <input
                                id="confirm-checkbox"
                                class="h-5 w-5 rounded border-gray-700 bg-gray-800 text-danger focus:ring-danger focus:ring-offset-background-dark"
                                type="checkbox"
                                required
                            />
                        </div>
                        <span class="text-sm text-gray-400 group-hover:text-gray-200 transition-colors">
                            I understand that my Vivento account cannot be recovered and all associated data will be permanently deleted.
                        </span>
                    </label>

                    <div class="flex flex-col gap-3 pt-2">
                        <button
                            type="submit"
                            class="flex w-full cursor-pointer items-center justify-center rounded-xl h-14 px-5 bg-danger text-white gap-2 font-bold shadow-lg shadow-danger/20 hover:bg-danger/90 transition-all active:scale-[0.98] disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                            <span class="material-symbols-outlined">delete_forever</span>
                            Request Account Deletion
                        </button>
                        <a
                            href="/"
                            class="flex w-full cursor-pointer items-center justify-center rounded-xl h-14 px-5 bg-transparent text-gray-400 font-bold hover:text-white transition-colors"
                        >
                            Cancel
                        </a>
                    </div>
                </form>
            </div>

            <!-- Contact Support -->
            <div class="mt-6 pt-6 border-t border-gray-800 text-center">
                <p class="text-sm text-gray-500">
                    Need help? Contact us at
                    <a href="mailto:support@vivento.fun" class="text-primary hover:underline">support@vivento.fun</a>
                </p>
            </div>
        </div>

        <div class="p-4 text-center text-xs text-gray-600">
            &copy; 2026 Vivento. All rights reserved.
        </div>
    </div>

    <script>
        document.getElementById('delete-form').addEventListener('submit', async function(e) {
            e.preventDefault();

            const email = document.getElementById('email').value;
            const checkbox = document.getElementById('confirm-checkbox').checked;

            if (!email || !checkbox) {
                return;
            }

            const submitButton = this.querySelector('button[type="submit"]');
            submitButton.disabled = true;
            submitButton.innerHTML = '<span class="material-symbols-outlined animate-spin">progress_activity</span> Processing...';

            try {
                const response = await fetch('/api/users/request-deletion', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email: email })
                });

                // Show success regardless of response (don't reveal if email exists)
                document.getElementById('main-content').classList.add('hidden');
                document.getElementById('success-message').classList.remove('hidden');

            } catch (error) {
                // Show success anyway for security (don't reveal if email exists)
                document.getElementById('main-content').classList.add('hidden');
                document.getElementById('success-message').classList.remove('hidden');
            }
        });
    </script>
</body>
</html>
