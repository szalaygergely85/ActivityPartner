<!DOCTYPE html>
<html class="dark" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0, viewport-fit=cover" name="viewport"/>
    <title>Login - Vivento</title>
    <link rel="icon" type="image/webp" href="/images/vivento.svg"/>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@200..800&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
    <link href="/css/app.css" rel="stylesheet"/>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#0d7ff2",
                        "danger": "#ef4444",
                        "warning": "#f59e0b",
                        "success": "#22c55e",
                        "background-dark": "#0a0f14",
                    },
                    fontFamily: {
                        "display": ["Plus Jakarta Sans", "sans-serif"]
                    },
                    borderRadius: {"DEFAULT": "0.5rem", "lg": "1rem", "xl": "1.5rem", "2xl": "2rem", "full": "9999px"},
                },
            },
        }
    </script>
</head>
<body class="bg-background-dark text-white min-h-screen flex items-center justify-center bg-gradient-custom relative overflow-x-hidden overflow-y-auto">
    <div class="absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-primary/10 rounded-full blur-[120px] pointer-events-none"></div>
    <div class="absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-blue-900/10 rounded-full blur-[120px] pointer-events-none"></div>

    <!-- Main Container -->
    <div class="w-full max-w-[900px] flex flex-col items-center justify-center px-4 sm:px-6 py-8 relative z-10">
        <div class="mb-8 sm:mb-10 flex items-center gap-2 group cursor-default">
            <img src="/images/vivento.svg" alt="Vivento" class="app-logo shadow-lg shadow-primary/20"/>
            <span class="text-2xl font-bold tracking-tight text-white/90">Vivento</span>
        </div>

        <!-- Cards Container - side by side on desktop -->
        <div class="w-full flex flex-col lg:flex-row gap-6 items-stretch">

            <!-- Login Card -->
            <div class="glass-card flex-1 rounded-2xl p-6 sm:p-10 text-center">
            <div class="mx-auto w-16 h-16 sm:w-20 sm:h-20 rounded-full bg-white/5 flex items-center justify-center mb-6 sm:mb-8 border border-white/10">
                <span class="material-symbols-outlined text-3xl sm:text-4xl text-primary">person</span>
            </div>
            <h1 class="text-2xl sm:text-3xl font-bold text-white mb-3 sm:mb-4">Welcome Back</h1>
            <p class="text-slate-400 text-base sm:text-lg leading-relaxed mb-8 sm:mb-10 max-w-sm mx-auto">
                Sign in to discover and join activities near you.
            </p>

            <form id="login-form" class="space-y-4 sm:space-y-6">
                <div class="relative group">
                    <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-slate-500 group-focus-within:text-primary transition-colors">
                        <span class="material-symbols-outlined text-xl sm:text-2xl">mail</span>
                    </div>
                    <input
                        id="email"
                        class="w-full bg-white/5 border border-white/10 rounded-xl py-3.5 sm:py-4 pl-12 pr-4 text-white placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all text-base"
                        placeholder="Email"
                        type="email"
                        autocomplete="email"
                        inputmode="email"
                        required
                    />
                </div>
                <div class="relative group">
                    <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-slate-500 group-focus-within:text-primary transition-colors">
                        <span class="material-symbols-outlined text-xl sm:text-2xl">lock</span>
                    </div>
                    <input
                        id="password"
                        class="w-full bg-white/5 border border-white/10 rounded-xl py-3.5 sm:py-4 pl-12 pr-12 text-white placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all text-base"
                        placeholder="Password"
                        type="password"
                        autocomplete="current-password"
                        required
                    />
                    <button type="button" id="toggle-password" class="absolute inset-y-0 right-0 pr-4 flex items-center text-slate-500 hover:text-slate-300 transition-colors">
                        <span class="material-symbols-outlined text-xl sm:text-2xl">visibility</span>
                    </button>
                </div>

                <div id="login-error" class="hidden text-danger text-sm py-2 px-4 bg-danger/10 rounded-xl"></div>

                <button id="submit-btn" class="glow-button w-full bg-primary hover:bg-primary/90 text-white font-bold py-3.5 sm:py-4 rounded-xl text-base sm:text-lg transition-all active:scale-[0.99] flex items-center justify-center gap-2 disabled:cursor-not-allowed" type="submit">
                    <span id="btn-text">Sign In</span>
                    <span id="btn-spinner" class="hidden">
                        <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    </span>
                    <span id="btn-arrow" class="material-symbols-outlined text-xl">arrow_forward</span>
                </button>
            </form>

            <div class="mt-6 sm:mt-8 pt-6 sm:pt-8 border-t border-white/10">
                <p class="text-slate-400 text-sm sm:text-base">
                    Don't have an account?
                    <a href="/register" class="text-primary hover:text-primary/80 font-semibold transition-colors">Sign up</a>
                </p>
            </div>
        </div>

            <!-- Download App Card -->
            <div class="glass-card lg:w-[320px] shrink-0 rounded-2xl p-6 flex flex-col justify-center text-center">
                <div class="mx-auto w-16 h-16 rounded-full bg-white/5 flex items-center justify-center mb-5 border border-white/10">
                    <span class="material-symbols-outlined text-3xl text-primary">smartphone</span>
                </div>
                <h3 class="text-xl font-bold text-white mb-2">Get the App</h3>
                <p class="text-slate-400 text-sm mb-6">Download Vivento on your mobile device for the best experience.</p>

                <div class="flex flex-col gap-3">
                    <!-- Android Download -->
                    <a href="https://play.google.com/store/apps/details?id=com.gege.vivento" target="_blank" rel="noopener"
                       class="flex items-center justify-center gap-3 px-5 py-3 bg-white/5 hover:bg-white/10 border border-white/10 rounded-xl transition-all">
                        <svg class="w-7 h-7" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M17.523 2.047a.5.5 0 0 0-.684.182l-1.97 3.41a8.968 8.968 0 0 0-5.742 0l-1.97-3.41a.5.5 0 0 0-.866.5l1.918 3.322A8.978 8.978 0 0 0 3 13.5V14h18v-.5a8.978 8.978 0 0 0-5.209-7.449l1.918-3.322a.5.5 0 0 0-.186-.682zM7 11a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm10 0a1 1 0 1 1 0-2 1 1 0 0 1 0 2zM3 15.5v5A1.5 1.5 0 0 0 4.5 22h1A1.5 1.5 0 0 0 7 20.5V15H3.5a.5.5 0 0 0-.5.5zm18 0a.5.5 0 0 0-.5-.5H17v5.5a1.5 1.5 0 0 0 1.5 1.5h1a1.5 1.5 0 0 0 1.5-1.5v-5zM7 15v6.5A1.5 1.5 0 0 0 8.5 23h7a1.5 1.5 0 0 0 1.5-1.5V15H7z" fill="#3DDC84"/>
                        </svg>
                        <div class="text-left">
                            <p class="text-xs text-slate-500">Download on</p>
                            <p class="text-sm font-semibold text-white">Google Play</p>
                        </div>
                    </a>

                    <!-- iOS Coming Soon -->
                    <div class="flex items-center justify-center gap-3 px-5 py-3 bg-white/5 border border-white/10 rounded-xl opacity-60 cursor-not-allowed">
                        <svg class="w-7 h-7 text-slate-400" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"/>
                        </svg>
                        <div class="text-left">
                            <p class="text-xs text-slate-500">Coming soon on</p>
                            <p class="text-sm font-semibold text-slate-400">App Store</p>
                        </div>
                    </div>
                </div>
            </div>

        </div><!-- End Cards Container -->

        <p class="mt-8 sm:mt-10 text-slate-500 text-xs sm:text-sm font-medium text-center">
            &copy; 2026 Vivento. All rights reserved.
        </p>
    </div>

    <div class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full h-full opacity-30 pointer-events-none">
        <div class="absolute top-1/4 left-1/4 w-96 h-96 bg-primary/20 rounded-full blur-[150px]"></div>
    </div>

    <script>
        // Toggle password visibility
        const passwordInput = document.getElementById('password');
        const toggleBtn = document.getElementById('toggle-password');

        toggleBtn.addEventListener('click', () => {
            const icon = toggleBtn.querySelector('.material-symbols-outlined');
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                icon.textContent = 'visibility_off';
            } else {
                passwordInput.type = 'password';
                icon.textContent = 'visibility';
            }
        });

        // Form submission
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const errorDiv = document.getElementById('login-error');
            const submitBtn = document.getElementById('submit-btn');
            const btnText = document.getElementById('btn-text');
            const btnSpinner = document.getElementById('btn-spinner');
            const btnArrow = document.getElementById('btn-arrow');

            // Show loading state
            submitBtn.disabled = true;
            btnText.textContent = 'Signing in...';
            btnSpinner.classList.remove('hidden');
            btnArrow.classList.add('hidden');
            errorDiv.classList.add('hidden');

            try {
                const response = await fetch('/api/users/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();

                if (response.ok) {
                    // Cookies are automatically set by the server
                    // Redirect to home/dashboard
                    window.location.href = '/';
                } else {
                    errorDiv.textContent = data.message || data.error || 'Invalid email or password';
                    errorDiv.classList.remove('hidden');
                }
            } catch (error) {
                errorDiv.textContent = 'Connection error. Please try again.';
                errorDiv.classList.remove('hidden');
            } finally {
                // Reset button state
                submitBtn.disabled = false;
                btnText.textContent = 'Sign In';
                btnSpinner.classList.add('hidden');
                btnArrow.classList.remove('hidden');
            }
        });

        // Check if already logged in (userId cookie is readable by JS)
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
            return null;
        }

        if (getCookie('userId')) {
            // Already logged in, redirect to home
            window.location.href = '/';
        }
    </script>
</body>
</html>
